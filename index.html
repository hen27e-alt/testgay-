<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="firebase.js"></script>

<title>Lobby</title>

<style>
body{
background:#0b0516;
color:white;
font-family:system-ui;
text-align:center;
padding:40px;
}
input,button{
padding:10px;
margin:10px;
border-radius:8px;
border:none;
}
button{
background:#7f13ec;
color:white;
font-weight:bold;
cursor:pointer;
}
</style>
</head>

<body>

<h2> GAYS TRIVIA</h2>

<input id="name" placeholder="砖 砖"><br>
<button onclick="createRoom()">爪专 专</button>

<br><br>

<input id="code" placeholder="拽 专"><br>
<button onclick="joinRoom()">爪专祝</button>

<script>

function getId(){
let id=localStorage.getItem("deviceId");
if(!id){
id="dev_"+Math.random().toString(36).substring(2,9);
localStorage.setItem("deviceId",id);
}
return id;
}

function randomCode(){
return Math.floor(1000+Math.random()*9000).toString();
}

function createRoom(){

const name=document.getElementById("name").value;
if(!name) return alert("住 砖");

const id=getId();
const room=randomCode();

firebase.database().ref("rooms/"+room).set({
host:id,
status:"waiting"
});

firebase.database().ref("rooms/"+room+"/players/"+id).set({
name:name,
score:0
});

window.location.href="./room.html?room="+room;
}

function joinRoom(){

const name=document.getElementById("name").value;
const room=document.getElementById("code").value;
if(!name || !room) return alert("住专 转");

const id=getId();

firebase.database().ref("rooms/"+room).once("value").then(snap=>{
if(!snap.exists()) return alert("专  拽");

firebase.database().ref("rooms/"+room+"/players/"+id).set({
name:name,
score:0
});

window.location.href="./room.html?room="+room;
});

}

</script>

</body>
</html>
