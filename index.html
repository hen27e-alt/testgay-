<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lobby</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="firebase.js"></script>

<style>
body{
margin:0;
font-family:system-ui;
background:#0b0516;
color:white;
text-align:center;
padding:40px;
}
button{
padding:12px 20px;
margin:10px;
border:none;
border-radius:10px;
background:#7f13ec;
color:white;
font-weight:bold;
cursor:pointer;
}
input{
padding:10px;
border-radius:8px;
border:none;
margin:5px;
}
</style>
</head>

<body>

<h2>GAYS TRIVIA – MULTI</h2>

<input id="name" placeholder="השם שלך"><br>
<button onclick="createRoom()">צור חדר</button>

<br><br>

<input id="joinCode" placeholder="קוד חדר"><br>
<button onclick="joinRoom()">הצטרף</button>

<script>

function getId(){
let id=localStorage.getItem("deviceId");
if(!id){
id="dev_"+Math.random().toString(36).substring(2,9);
localStorage.setItem("deviceId",id);
}
return id;
}

function randomCode(){
return Math.floor(1000+Math.random()*9000).toString();
}

function createRoom(){

const name=document.getElementById("name").value;
if(!name) return alert("הכנס שם");

localStorage.setItem("nickname",name);
const id=getId();
const code=randomCode();

firebase.database().ref("rooms/"+code).set({
host:id,
status:"waiting",
questionIndex:0,
timer:0
});

firebase.database().ref("rooms/"+code+"/players/"+id).set({
nickname:name,
score:0
});

window.location.href="room.html?room="+code;
}

function joinRoom(){

const name=document.getElementById("name").value;
const code=document.getElementById("joinCode").value;

if(!name || !code) return alert("חסר שם או קוד");

localStorage.setItem("nickname",name);
const id=getId();

firebase.database().ref("rooms/"+code).once("value").then(snap=>{
if(!snap.exists()) return alert("חדר לא קיים");

firebase.database().ref("rooms/"+code+"/players/"+id).set({
nickname:name,
score:0
});

window.location.href="room.html?room="+code;
});
}

</script>

</body>
</html>